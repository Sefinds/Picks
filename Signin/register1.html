<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="../manifest.json">
  <script src="../main.js"></script>
  <!--Links-->
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <link rel="stylesheet" href="register1.css">
  <title>register</title>
</head>

<body>
  <div onload="myFunction">

  <div class="wrapper-1">
    <div class="wrapperitem-1">
      <span class="titulo">Almost finished! </span> <br>
      <span class="subtitulo">Just choose your name and Pick a Pick</span>
    </div><br><br><br><br>

    <div class="wrapperitem-1">
        <div class="username">
          <input id="username" type="text" class="text-line" placeholder="Username" required>
        </div>
    </div>
  </div><br><br><br><br>


  <div class="wrapper-2">
    <div class="wrapperitem-2">
      <button id="1"  style="background: rgba(242, 160, 199, 1);  border-color: rgba(212, 20, 90, 1);">
          <img id="pinki" src="">
      </button>
    </div>

    <div class="wrapperitem-2">
        <button id="2" style="background: rgba(245, 182, 119, 0.7799999713897705);  border-color: rgba(241, 90, 36, 1);">
            <img id="bubble" src="">
        </button>
    </div>

    <div class="wrapperitem-2">
        <button id="3" style="background: rgba(33, 181, 115, 0.7099999785423279);  border-color: rgba(0, 104, 55, 1);">
            <img id="miss" src="">
        </button>
    </div>

    <div class="wrapperitem-2">
        <button id="4" style="background: rgba(198, 156, 109, 0.6899999976158142);  border-color: rgba(141, 100, 58, 1);">
            <img id="poop" src="">
        </button>
    </div>

    <div class="wrapperitem-2">
        <button id="5" style="background: rgba(40, 171, 226, 0.36000001430511475);  border-color: rgba(99, 89, 137, 1);">
            <img id="blue" src="">
        </button>
    </div>

    <div class="wrapperitem-2">
        <button id="6" style="background: rgba(196, 196, 196, 0.47999998927116394);  border-color: rgba(153, 153, 153, 1);">
            <img id="rob" src="">
        </button>
    </div>
  </div>

<br><br>
  <div class="wrapper-1">
    <div class="wrapperitem-1">
        <a id="letsgo" class="letsgo" style="text-decoration: none;">
          <div class="letsgo-color">
          <div class="letsgo-box">
            <span class="letsgo-text">Letâ€™s Go</span>
          </div>
          </div>
        </a>
      </div>
  </div>

        <!--<span class="trespontos">..</span>-->
  </div>


  <script src="../firebase.js" type="module"></script>

  <script type="module">
    import {
      auth,
      db,
      user
    } from "../firebase.js";
    import {
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      doc,
      setDoc,
      updateDoc,
      getDocs,
      onSnapshot,
      getDoc
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore.js";
    import {
      getStorage, ref, uploadBytesResumable, getDownloadURL, getMetadata
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-storage.js";

//buscar imagens da storage e fazer output delas
    function myFunction()
    {
      const storage = getStorage();
      //const mountainsRef = ref(storage, 'Picks/Pinki.png');
      //const pinki = 'Pinki.png';

      getDownloadURL(ref(storage, 'Picks/Pinki.png'))
        .then((url) => {
          const pinkiimg = document.getElementById('pinki');
          pinkiimg.setAttribute('src', url);
          console.log(url);
        })
      getDownloadURL(ref(storage, 'Picks/Bubble.png'))
        .then((url) => {
          const bubbleimg = document.getElementById('bubble');
          bubbleimg.setAttribute('src', url);
        })
      getDownloadURL(ref(storage, 'Picks/Miss.png'))
        .then((url) => {
          const missimg = document.getElementById('miss');
          missimg.setAttribute('src', url);
        })
      getDownloadURL(ref(storage, 'Picks/Poop.png'))
        .then((url) => {
          const poopimg = document.getElementById('poop');
          poopimg.setAttribute('src', url);
        })
      getDownloadURL(ref(storage, 'Picks/Blue.png'))
        .then((url) => {
          const blueimg = document.getElementById('blue');
          blueimg.setAttribute('src', url);
        })
      getDownloadURL(ref(storage, 'Picks/Rob.png'))
        .then((url) => {
          const robimg = document.getElementById('rob');
          robimg.setAttribute('src', url);
        })
        .catch((error) => {
          // Handle any errors
        });
        }
    console.log(myFunction())
    window.myFunction = myFunction;

//Pinki
    document.getElementById("1").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FPinki.png?alt=media&token=424e0137-d532-4f06-906b-ef49348a0d63');
      sessionStorage.setItem('imgcolor', 'rgba(242, 160, 199, 1)');
      sessionStorage.setItem('bordercolor', 'rgba(212, 20, 90, 1)');
        });
//Bubble
      document.getElementById("2").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FBubble.png?alt=media&token=6315a89b-d4a2-446f-aed2-c50d47503360');
      sessionStorage.setItem('imgcolor', 'rgba(245, 182, 119, 0.7799999713897705)');
      sessionStorage.setItem('bordercolor', 'rgba(241, 90, 36, 1)');
        });
//Miss
      document.getElementById("3").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FMiss.png?alt=media&token=57c82251-32dd-400e-96fd-c71b45535dee');
      sessionStorage.setItem('imgcolor', 'rgba(33, 181, 115, 0.7099999785423279)');
      sessionStorage.setItem('bordercolor', 'rgba(0, 104, 55, 1)');
        });
//Poop
      document.getElementById("4").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FPoop.png?alt=media&token=e1a86a73-f4e0-476c-adf4-998d2a54ca8b');
      sessionStorage.setItem('imgcolor', 'rgba(198, 156, 109, 0.6899999976158142)');
      sessionStorage.setItem('bordercolor', 'rgba(141, 100, 58, 1)');
        });
//Blue
      document.getElementById("5").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FBlue.png?alt=media&token=87b2aad6-0d39-43bf-9aad-02c3aa76df35');
      sessionStorage.setItem('imgcolor', 'rgba(40, 171, 226, 0.36000001430511475)');
      sessionStorage.setItem('bordercolor', 'rgba(99, 89, 137, 1)');
        });
//Rob
      document.getElementById("6").addEventListener('click', (e) => {
      sessionStorage.setItem('img', 'https://firebasestorage.googleapis.com/v0/b/picks-5fe86.appspot.com/o/Picks%2FRob.png?alt=media&token=a6687143-f2f5-444f-924b-87f48f3b445b');
      sessionStorage.setItem('imgcolor', 'rgba(196, 196, 196, 0.47999998927116394)');
      sessionStorage.setItem('bordercolor', 'rgba(153, 153, 153, 1)');
        });


    document.getElementById("letsgo").addEventListener('click', (e) => {
      var username = document.getElementById('username').value;
      var imgs = sessionStorage.getItem('img');
      var imgscolor = sessionStorage.getItem('imgcolor');
      var bordercolors = sessionStorage.getItem('bordercolor');
      console.log(username);

      onAuthStateChanged(auth, (user) => {
        if (user) {
          const uid = user.uid;
          //console.log(user.uid);
          const ref = doc(db, 'Users', uid);

          getDoc(ref).then(user => {
            if (user.exists()) {
              localStorage.setItem('users', JSON.stringify(user.data()));
              //console.log(localStorage.getItem('users'));
              window.location.href = "../Home/home.html";
            } else {
              console.log('Este produto nao existe.');
            }
          });

          updateDoc(ref, {
            username: username,
            pick: imgs,
            pickcolor: imgscolor,
            pickborder: bordercolors
          }).then(() => {
            alert("data added sucessfully");
          });

        } else {
          alert("error");
        }

      });
    });

  </script>
</body>

</html>
